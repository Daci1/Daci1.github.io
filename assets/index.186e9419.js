var b=Object.defineProperty;var w=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var y=(o,e,s)=>e in o?b(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s,S=(o,e)=>{for(var s in e||(e={}))M.call(e,s)&&y(o,s,e[s]);if(w)for(var s of w(e))A.call(e,s)&&y(o,s,e[s]);return o};import*as n from"https://cdn.jsdelivr.net/npm/three@0.124/build/three.module.js";import{FBXLoader as x}from"https://cdn.jsdelivr.net/npm/three@0.124/examples/jsm/loaders/FBXLoader.js";import*as _ from"https://cdn.jsdelivr.net/npm/three@0.122/build/three.module.js";import{GLTFLoader as v}from"https://cdn.jsdelivr.net/npm/three@0.122/examples/jsm/loaders/GLTFLoader.js";const P=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))h(i);new MutationObserver(i=>{for(const t of i)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&h(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const t={};return i.integrity&&(t.integrity=i.integrity),i.referrerpolicy&&(t.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?t.credentials="include":i.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function h(i){if(i.ep)return;i.ep=!0;const t=s(i);fetch(i.href,t)}};P();const L=(()=>{class o{constructor(s){this.position_=new n.Vector3(0,0,0),this.velocity_=0,this.playerBox_=new n.Box3,this.params_=s,this.LoadModel_(),this.InitInput_()}LoadModel_(){const s=new x;s.setPath("./resources/Dinosaurs/FBX/"),s.load("Velociraptor.fbx",h=>{h.scale.setScalar(.0025),h.quaternion.setFromAxisAngle(new n.Vector3(0,1,0),Math.PI/2),this.mesh_=h,this.params_.scene.add(this.mesh_),h.traverse(t=>{let a=t.material;t.material instanceof Array||(a=[t.material]);for(let r of a)r&&(r.specular=new n.Color(0),r.color.offsetHSL(0,0,.25));t.castShadow=!0,t.receiveShadow=!0});const i=new n.AnimationMixer(h);this.mixer_=i;for(let t=0;t<h.animations.length;++t)if(h.animations[t].name.includes("Run")){const a=h.animations[t];this.mixer_.clipAction(a).play()}})}InitInput_(){this.keys_={spacebar:!1},this.oldKeys=S({},this.keys_),document.addEventListener("keydown",s=>this.OnKeyDown_(s),!1),document.addEventListener("keyup",s=>this.OnKeyUp_(s),!1)}OnKeyDown_(s){switch(s.keyCode){case 32:this.keys_.space=!0;break}}OnKeyUp_(s){switch(s.keyCode){case 32:this.keys_.space=!1;break}}CheckCollisions_(){const s=this.params_.world.GetColliders();this.playerBox_.setFromObject(this.mesh_);for(let h of s)h.collider.intersectsBox(this.playerBox_)&&(this.gameOver=!0)}Update(s){this.keys_.space&&this.position_.y==0&&(this.velocity_=30);const h=-75*s;this.position_.y+=s*(this.velocity_+h*.5),this.position_.y=Math.max(this.position_.y,0),this.velocity_+=h,this.velocity_=Math.max(this.velocity_,-100),this.mesh_&&(this.mixer_.update(s),this.mesh_.position.copy(this.position_),this.CheckCollisions_())}}return{Player:o}})(),d=function(){return{rand_range:function(o,e){return Math.random()*(e-o)+o},rand_normalish:function(){return(Math.random()+Math.random()+Math.random()+Math.random())/4*2-1},rand_int:function(o,e){return Math.round(Math.random()*(e-o)+o)},lerp:function(o,e,s){return o*(s-e)+e},smoothstep:function(o,e,s){return o=o*o*(3-2*o),o*(s-e)+e},smootherstep:function(o,e,s){return o=o*o*o*(o*(o*6-15)+10),o*(s-e)+e},clamp:function(o,e,s){return Math.min(Math.max(o,e),s)},sat:function(o){return Math.min(Math.max(o,0),1)},in_range:(o,e,s)=>o>=e&&o<=s}}(),O=(()=>{class s{constructor(t){this.position=new n.Vector3,this.quaternion=new n.Quaternion,this.scale=1,this.collider=new n.Box3,this.params_=t,this.LoadModel_()}LoadModel_(){const a=new n.TextureLoader().load("./resources/DesertPack/Blend/Textures/Ground.png");a.encoding=n.sRGBEncoding;const r=new x;r.setPath("./resources/DesertPack/FBX/"),r.load("Cactus3.fbx",c=>{c.scale.setScalar(.01),this.mesh=c,this.params_.scene.add(this.mesh),c.traverse(l=>{l.geometry&&l.geometry.computeBoundingBox();let u=l.material;l.material instanceof Array||(u=[l.material]);for(let m of u)m&&(a&&(m.map=a),m.specular=new n.Color(0));l.castShadow=!0,l.receiveShadow=!0})})}UpdateCollider_(){this.collider.setFromObject(this.mesh)}Update(t){!this.mesh||(this.mesh.position.copy(this.position),this.mesh.quaternion.copy(this.quaternion),this.mesh.scale.setScalar(this.scale),this.UpdateCollider_())}}class h{constructor(t){this.objects_=[],this.unused_=[],this.speed_=12,this.params_=t,this.score_=0,this.scoreText_="00000",this.separationDistance_=20}GetColliders(){return this.objects_}LastObjectPosition_(){return this.objects_.length==0?20:this.objects_[this.objects_.length-1].position.x}SpawnObj_(t,a){let r=null;this.unused_.length>0?(r=this.unused_.pop(),r.mesh.visible=!0):r=new s(this.params_),r.quaternion.setFromAxisAngle(new n.Vector3(0,1,0),Math.random()*Math.PI*2),r.position.x=100+a,r.scale=t*.01,this.objects_.push(r)}SpawnCluster_(){const t=d.rand_int(0,1),a=[1,.5],r=[2,3],c=a[t],l=d.rand_int(1,r[t]);for(let u=0;u<l;++u){const m=u*1*c;this.SpawnObj_(c,m)}}MaybeSpawn_(){const t=this.LastObjectPosition_();Math.abs(100-t)>this.separationDistance_&&(this.SpawnCluster_(),this.separationDistance_=d.rand_range(20,20*1.5))}Update(t){this.MaybeSpawn_(),this.UpdateColliders_(t),this.UpdateScore_(t)}UpdateScore_(t){this.score_+=t*10;const a=Math.round(this.score_).toLocaleString("en-US",{minimumIntegerDigits:5,useGrouping:!1});a!=this.scoreText_&&(document.getElementById("score-text").innerText=a)}UpdateColliders_(t){const a=[],r=[];for(let c of this.objects_)c.position.x-=t*this.speed_,c.position.x<-20?(a.push(c),c.mesh.visible=!1):r.push(c),c.Update(t);this.objects_=r,this.unused_.push(...a)}}return{WorldManager:h}})(),k=(()=>{class o{constructor(i){this.params_=i,this.position_=new _.Vector3,this.quaternion_=new _.Quaternion,this.scale_=1,this.mesh_=null,this.LoadModel_()}LoadModel_(){const i=new v;i.setPath("./resources/Clouds/GLTF/"),i.load("Cloud"+d.rand_int(1,3)+".glb",t=>{this.mesh_=t.scene,this.params_.scene.add(this.mesh_),this.position_.x=d.rand_range(0,2e3),this.position_.y=d.rand_range(100,200),this.position_.z=d.rand_range(500,-1e3),this.scale_=d.rand_range(10,20);const a=new _.Quaternion().setFromAxisAngle(new _.Vector3(0,1,0),d.rand_range(0,360));this.quaternion_.copy(a),this.mesh_.traverse(r=>{r.geometry&&r.geometry.computeBoundingBox();let c=r.material;r.material instanceof Array||(c=[r.material]);for(let l of c)l&&(l.specular=new _.Color(0),l.emissive=new _.Color(12632256));r.castShadow=!0,r.receiveShadow=!0})})}Update(i){!this.mesh_||(this.position_.x-=i*10,this.position_.x<-100&&(this.position_.x=d.rand_range(2e3,3e3)),this.mesh_.position.copy(this.position_),this.mesh_.quaternion.copy(this.quaternion_),this.mesh_.scale.setScalar(this.scale_))}}class e{constructor(i){this.params_=i,this.position_=new _.Vector3,this.quaternion_=new _.Quaternion,this.scale_=1,this.mesh_=null,this.LoadModel_()}LoadModel_(){const i=[["Monument.glb","Ground.png",15],["SmallPalmTree.glb","PalmTree.png",4],["BigPalmTree.glb","PalmTree.png",6],["Cactus1.glb","Ground.png",10],["Cactus2.glb","Ground.png",10],["Cactus3.glb","Ground.png",10],["Skull.glb","Ground.png",2]],[t,a,r]=i[d.rand_int(0,i.length-1)],l=new _.TextureLoader().load("./resources/DesertPack/Blend/Textures/"+a);l.encoding=_.sRGBEncoding;const u=new v;u.setPath("./resources/DesertPack/GLTF/"),u.load(t,m=>{this.mesh_=m.scene,this.params_.scene.add(this.mesh_),this.position_.x=d.rand_range(0,2e3),this.position_.z=d.rand_range(500,-1e3),this.scale_=r;const C=new _.Quaternion().setFromAxisAngle(new _.Vector3(0,1,0),d.rand_range(0,360));this.quaternion_.copy(C),this.mesh_.traverse(p=>{let g=p.material;p.material instanceof Array||(g=[p.material]);for(let f of g)f&&(l&&(f.map=l),f.specular=new _.Color(0));p.castShadow=!0,p.receiveShadow=!0})})}Update(i){!this.mesh_||(this.position_.x-=i*10,this.position_.x<-100&&(this.position_.x=d.rand_range(2e3,3e3)),this.mesh_.position.copy(this.position_),this.mesh_.quaternion.copy(this.quaternion_),this.mesh_.scale.setScalar(this.scale_))}}class s{constructor(i){this.params_=i,this.clouds_=[],this.crap_=[],this.SpawnClouds_(),this.SpawnCrap_()}SpawnClouds_(){for(let i=0;i<25;++i){const t=new o(this.params_);this.clouds_.push(t)}}SpawnCrap_(){for(let i=0;i<50;++i){const t=new e(this.params_);this.crap_.push(t)}}Update(i){for(let t of this.clouds_)t.Update(i);for(let t of this.crap_)t.Update(i)}}return{Background:s}})();const F=`
varying vec3 vWorldPosition;
void main() {
  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
  vWorldPosition = worldPosition.xyz;
  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,T=`
uniform vec3 topColor;
uniform vec3 bottomColor;
uniform float offset;
uniform float exponent;
varying vec3 vWorldPosition;
void main() {
  float h = normalize( vWorldPosition + offset ).y;
  gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );
}`;class B{constructor(){this._Initialize(),this._gameStarted=!1,document.getElementById("game-menu").onclick=e=>this._OnStart(e)}_OnStart(e){document.getElementById("game-menu").style.display="none",this._gameStarted=!0}_Initialize(){let e=n.ShaderChunk.shadowmap_pars_fragment;n.ShaderChunk.shadowmap_pars_fragment=e,this.initializeRenderer(),window.addEventListener("resize",()=>{this.OnWindowResize_()},!1),this.initializeCamera(),this.scene_=new n.Scene,this.initializeLight(),this.scene_.background=new n.Color(8421504),this.scene_.fog=new n.FogExp2(9024235,.00125);const s=new n.Mesh(new n.PlaneGeometry(22e3,22e3,10,10),new n.MeshStandardMaterial({color:16184447}));s.castShadow=!1,s.receiveShadow=!0,s.rotation.x=-Math.PI/2,this.scene_.add(s);const h={topColor:{value:new n.Color(30719)},bottomColor:{value:new n.Color(9024235)},offset:{value:33},exponent:{value:.6}},i=new n.SphereBufferGeometry(1e3,32,15),t=new n.ShaderMaterial({uniforms:h,vertexShader:F,fragmentShader:T,side:n.BackSide});this.scene_.add(new n.Mesh(i,t)),this.world_=new O.WorldManager({scene:this.scene_}),this.player_=new L.Player({scene:this.scene_,world:this.world_}),this.background_=new k.Background({scene:this.scene_}),this.gameOver_=!1,this.previousRAF_=null,this.RAF_(),this.OnWindowResize_()}initializeRenderer(){this.threejs_=new n.WebGLRenderer({antialias:!0}),this.threejs_.outputEncoding=n.sRGBEncoding,this.threejs_.gammaFactor=2.4,this.threejs_.shadowMap.enabled=!0,this.threejs_.setPixelRatio(window.devicePixelRatio),this.threejs_.setSize(window.innerWidth,window.innerHeight),document.getElementById("container").appendChild(this.threejs_.domElement)}initializeCamera(){const s=1.7777777777777777,h=1.5,i=22e3;this.camera_=new n.PerspectiveCamera(70,s,h,i),this.camera_.position.set(-5,5,10),this.camera_.lookAt(8,3,0)}initializeLight(){let e=new n.DirectionalLight(16777215,1);e.position.set(60,100,10),e.target.position.set(40,0,0),e.castShadow=!0,e.shadow.bias=-.001,e.shadow.mapSize.width=4096,e.shadow.mapSize.height=4096,e.shadow.camera.far=200,e.shadow.camera.near=1,e.shadow.camera.left=50,e.shadow.camera.right=-50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,this.scene_.add(e),e=new n.HemisphereLight(2105376,16512,.6),this.scene_.add(e)}OnWindowResize_(){this.camera_.aspect=window.innerWidth/window.innerHeight,this.camera_.updateProjectionMatrix(),this.threejs_.setSize(window.innerWidth,window.innerHeight)}RAF_(){requestAnimationFrame(e=>{this.previousRAF_===null&&(this.previousRAF_=e),this.RAF_(),this.Step_((e-this.previousRAF_)/1e3),this.threejs_.render(this.scene_,this.camera_),this.previousRAF_=e})}Step_(e){this.gameOver_||!this._gameStarted||(this.player_.Update(e),this.world_.Update(e),this.background_.Update(e),this.player_.gameOver&&!this.gameOver_&&(this.gameOver_=!0,this.gameOver()))}gameOver(){document.getElementById("game-over").classList.toggle("active"),setTimeout(()=>history.go(0),2e3)}}document.getElementById("startGame").onclick=()=>{new B};
